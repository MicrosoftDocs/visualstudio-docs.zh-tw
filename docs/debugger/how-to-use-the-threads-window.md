---
title: 偵錯多執行緒應用程式
description: 偵錯使用 Visual Studio 中的 [執行緒] 視窗和偵錯位置工具列
ms.date: 11/21/2018
ms.topic: conceptual
dev_langs:
- CSharp
- VB
- FSharp
- C++
helpviewer_keywords:
- multithreaded debugging, tutorial
- tutorials, multithreaded debugging
ms.assetid: adfbe002-3d7b-42a9-b42a-5ac0903dfc25
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: b205a92607d55b9999a846c860235c7deb5b13ae
ms.sourcegitcommit: b0d8e61745f67bd1f7ecf7fe080a0fe73ac6a181
ms.translationtype: MTE95
ms.contentlocale: zh-TW
ms.lasthandoff: 02/22/2019
ms.locfileid: "56680213"
---
# <a name="walkthrough-debug-a-multithreaded-app-using-the-threads-window-c-visual-basic-c"></a>逐步解說： 偵錯多執行緒的應用程式，使用 [執行緒] 視窗 (C#，Visual Basic、 c + +)

數個 Visual Studio 使用者介面項目可協助您偵錯多執行緒應用程式。 這篇文章介紹在程式碼編輯器 視窗中，多執行緒偵錯功能**偵錯位置**工具列上，並**執行緒**視窗。 如需其他工具進行偵錯多執行緒應用程式的資訊，請參閱[開始偵錯多執行緒應用程式](../debugger/get-started-debugging-multithreaded-apps.md)。

完成本教學課程只需要幾分鐘，並讓您熟悉的偵錯多執行緒應用程式基本概念。

## <a name="create-a-multithreaded-app-project"></a>建立多執行緒應用程式專案

建立下列的多執行緒應用程式專案，以使用在本教學課程：

1. 在 Visual Studio 中，選取 [檔案] > [新增] > [專案]。

1. 在 [新增專案] 對話方塊中：
   - 針對C#應用程式，選取**視覺化C#**    > **主控台應用程式 (.NET Framework)**。
   - C + + 應用程式中，選取**Visual c + +** > **Windows 主控台應用程式**。

1. 名稱 MyThreadWalkthroughApp，應用程式，然後選取**確定**。

   新的專案會出現在**方案總管 中**，和原始程式檔名*Program.cs*或是*MyThreadWalkthroughApp.cpp*會在原始程式碼視窗中開啟。

1. 原始程式檔與程式碼取代C#或 c + + 範例程式碼，從[開始偵錯多執行緒應用程式](../debugger/get-started-debugging-multithreaded-apps.md)。

1. 選取 **檔案** > **全部儲存**。

## <a name="start-debugging"></a>開始偵錯

1. 在原始程式碼中尋找下列幾行：

   ```csharp
   Thread.Sleep(3000);
   Console.WriteLine();
   ```

   ```C++
   Thread::Sleep(3000);
   Console.WriteLine();
   ```

1. 上設定中斷點`Console.WriteLine();`列中的左裝訂邊，按一下或選取線條，然後按**F9**。

   中斷點會顯示為程式碼行旁的左裝訂邊的紅色圓圈。

1. 選取 **偵錯** > **開始偵錯**，或按**F5**。

   應用程式在偵錯模式中，會啟動，並在中斷點暫停。

1. 在中斷模式中開啟**執行緒**視窗中的選取**偵錯** > **Windows** > **執行緒**。 您必須在偵錯工作階段中開啟，或請參閱**執行緒**和其他偵錯視窗。

## <a name="examine-thread-markers"></a>檢查執行緒標記

1. 在原始程式碼中，找出`Console.WriteLine();`列。

   1. 以滑鼠右鍵按一下**執行緒** 視窗中，然後選取**在來源中顯示執行緒**![在來源中顯示執行緒](../debugger/media/dbg-multithreaded-show-threads.png "ThreadMarker")從功能表。

   裝訂邊，旁邊的原始程式碼行現在會顯示*執行緒標記*圖示![執行緒標記](../debugger/media/dbg-thread-marker.png "執行緒標記")。 執行緒標記表示執行緒會停在這個位置上。 如果在位置中，有多個已停止的執行緒![多個執行緒](../debugger/media/dbg-multithreaded-show-threads.png "多個執行緒")圖示會出現。

1. 將指標移到執行緒標記上。 資料提示方塊出現時，它會顯示 已停止的執行緒或執行緒的名稱和執行緒 ID 編號。 執行緒名稱可能`<No Name>`。

   >[!TIP]
   >為了協助識別沒有名稱的執行緒，您可以在**執行緒**視窗。 以滑鼠右鍵按一下執行緒，然後選取**重新命名**。

1. 以滑鼠右鍵按一下執行緒標記，在 原始碼，以查看可用的捷徑功能表上的選項。

## <a name="flag-and-unflag-threads"></a>將執行緒加上旗標和取消旗標

您可以旗標來追蹤您想要特別注意的執行緒的執行緒。

旗標，並將從原始程式碼編輯器，或從執行緒取消標幟**執行緒**視窗。 選擇是否要顯示 僅顯示執行緒或所有的執行緒，從已標幟**偵錯位置**或是**執行緒**視窗工具列。 從任何位置所做的選擇會影響所有位置。

### <a name="flag-and-unflag-threads-in-source-code"></a>旗標，並將原始程式碼中的執行緒取消標幟

1. 開啟**偵錯位置**藉由選取工具列**檢視** > **工具列** > **偵錯位置**。 您也可以在工具列區域中以滑鼠右鍵按一下並選取**偵錯位置**。

1. **偵錯位置**工具列上有三個欄位：**程序**，**執行緒**，以及**堆疊框架**。 下拉式清單**執行緒**清單，並記下有多少執行緒。 在 [**執行緒**] 清單中，目前執行中執行緒由標記**>** 符號。

1. 在來源的程式碼視窗中，將滑鼠停留在裝訂邊中的執行緒標記圖示，並在資料提示方塊中選取的旗標圖示 （或空的旗標圖示的其中一個）。 旗標圖示會變成紅色。

   您也可以以滑鼠右鍵按一下執行緒標記圖示，指向**旗標**，然後選取 快顯功能表中加上旗標的執行緒。

1. 在 **偵錯位置**工具列上，選取**僅顯示已標幟的執行緒**圖示![顯示已標幟的執行緒](../debugger/media/dbg-threads-show-flagged.png "顯示已標幟的執行緒")至角**執行緒**欄位。 除非一個或多個執行緒會加上旗標圖示被灰色。

   只有已標幟的執行緒現在會出現在**執行緒**工具列下拉式清單中的。 若要再次顯示所有執行緒，請選取**僅都顯示已標幟的執行緒**圖示一次。

   >[!TIP]
   >您有已標幟的一些執行緒後，您可以將游標放在程式碼編輯器中，按一下滑鼠右鍵，然後選取**執行至游標處加上旗標的執行緒**。 請務必選擇 所有已標幟的執行緒的程式碼會到達。 **執行至游標處加上旗標的執行緒**執行緒上選取的行程式碼，讓您更輕鬆地控制所執行的順序，將會暫停[凍結和解除凍結執行緒](#bkmk_freeze)。

1. 若要切換目前執行中執行緒的加上旗標或取消旗標了狀態，請選取 單一旗標**切換目前執行緒已標幟狀態**工具列按鈕，左邊**僅顯示已標幟的執行緒**按鈕。 目前的執行緒加上旗標是用於尋找目前的執行緒，會顯示已標幟的執行緒時。

1. 若要取消執行緒的旗標，停留在原始程式碼中的執行緒標記並選取紅色旗標圖示，以清除它，或以滑鼠右鍵按一下執行緒標記，然後選取**取消旗標**。

### <a name="flag-and-unflag-threads-in-the-threads-window"></a>旗標，並將 [執行緒] 視窗中的執行緒取消標幟

在 [**執行緒**] 視窗中，已標幟的執行緒有紅色旗標圖示旁邊，未標幟的執行緒時，如果顯示，有空白的圖示。

![執行緒視窗](../debugger/media/dbg-threads-window.png "執行緒視窗")

選取的旗標圖示，以將執行緒狀態變更為加上旗標或取消旗標了，根據目前的狀態。

您也可以以滑鼠右鍵按一下線條，然後選取**旗標**，**取消旗標**，或**取消旗標的所有執行緒**從捷徑功能表。

**執行緒** 視窗工具列還有**僅顯示已標幟執行緒**按鈕，也就是兩個旗標圖示的其中一個的任一個。 它適用於按鈕相同**偵錯位置**工具列和任一個按鈕控制在兩個位置的顯示。

### <a name="other-threads-window-features"></a>其他執行緒視窗功能

在 [**執行緒**] 視窗中，選取要排序的執行緒，依據該資料行的任何資料行的標頭。 若要反轉排序次序，請選取一次。 顯示所有執行緒，如果選取的旗標圖示資料行來排序執行緒加上旗標或取消旗標了狀態。

第二個資料行**執行緒**（使用不含標頭） 視窗**目前執行緒**資料行。 此資料行中的黃色箭號標示目前的執行點。

**位置**資料行會顯示每個執行緒在原始程式碼中出現的位置。 選取的展開箭號旁**位置**項目或將滑鼠停駐的項目，以顯示該執行緒的部分呼叫堆疊。

>[!TIP]
>執行緒的呼叫堆疊的圖形檢視，使用[平行堆疊](../debugger/using-the-parallel-stacks-window.md)視窗。 若要開啟的視窗中，偵錯時，請選取**偵錯**> **Windows** > **平行堆疊**。

除了**旗標**，**取消旗標**，並**取消旗標的所有執行緒**，以滑鼠右鍵按一下內容功能表**執行緒**視窗項目有：

- **在來源中顯示執行緒** 按鈕。
- **十六進位顯示**，變更**執行緒 ID**中的 s**執行緒**小數位的十六進位格式的視窗。
- [切換至執行緒](#switch-to-another-thread)，立即切換至該執行緒的執行。
- **重新命名**，這可讓您變更執行緒的名稱。
- [凍結和解除凍結](#bkmk_freeze)命令。

## <a name="bkmk_freeze"></a> 凍結和解除凍結執行緒的執行

您可以凍結和解除凍結，或暫停和繼續執行緒，來控制執行緒執行工作的順序。 凍結和解除凍結執行緒可協助您解決並行存取問題，例如死結和競爭情形。

> [!TIP]
> 若要依照單一執行緒沒有凍結的其他執行緒，這也是常見的偵錯案例，請參閱[開始偵錯多執行緒應用程式](../debugger/get-started-debugging-multithreaded-apps.md#bkmk_follow_a_thread)。

**凍結和解除凍結執行緒：**

1. 在 [**執行緒**] 視窗中，以滑鼠右鍵按一下任何執行緒，然後按**凍結**。 A**暫停**中的圖示**目前的執行緒**資料行會指出已凍結執行緒。

1. 選取 [**資料行**中**執行緒**] 視窗工具列上，然後選取**暫停計數**以顯示**暫停計數**資料行。 凍結執行緒的暫停的計數值是**1**。

1. 以滑鼠右鍵按一下凍結的執行緒，然後選取**解除凍結**。

   **暫停**圖示就會消失，而**暫停計數**值會變成**0**。

## <a name="switch-to-another-thread"></a>切換至另一個執行緒

您可能會看到**應用程式處於中斷模式**視窗中，當您嘗試切換至另一個執行緒。 此視窗會告訴您該執行緒沒有任何目前的偵錯工具可以顯示的程式碼。 例如，您可能要偵錯 managed 程式碼，但執行緒是原生程式碼。 視窗會提供解決問題的建議。

**若要切換至另一個執行緒：**

1. 在 [**執行緒**] 視窗中，記下目前的執行緒識別碼，這是在執行緒中的黃色箭號**目前的執行緒**資料行。 您會想要切換回此執行緒能夠繼續您的應用程式。

1. 以滑鼠右鍵按一下不同的執行緒，然後選取**切換至執行緒**從內容功能表。

1. 觀察中已變更的黃色箭號位置**執行緒**視窗。 原始目前的執行緒標記也會保留，成外框。

   查看 執行緒標記，在程式碼的原始檔編輯器中，並在清單上的 工具提示**執行緒**下拉式清單中**偵錯位置**工具列。 觀察目前的執行緒已也會那里的變更。

1. 在上**偵錯位置**工具列上，選取 從不同的執行緒**執行緒**清單。 請注意，目前的執行緒也會變更在其他兩個位置。

1. 在 原始程式碼編輯器，以滑鼠右鍵按一下執行緒標記，並指向**切換至執行緒**，並從清單中選取另一個執行緒。 請注意，目前的執行緒就會變更在所有三個位置。

與原始程式碼中的執行緒標記，您只能切換到該位置已停止的執行緒。 使用 [執行緒] 視窗和 [偵錯位置] 工具列時，您可以切換至任何執行緒。

您現在已了解偵錯多執行緒應用程式基本的概念。 您可以觀察，加上旗標和取消旗標，凍結和解除凍結執行緒藉由使用**執行緒** 視窗中，**執行緒**清單中**偵錯位置**工具列或中的執行緒標記原始碼程式碼編輯器。

## <a name="see-also"></a>另請參閱
- [偵錯多執行緒應用程式](../debugger/debug-multithreaded-applications-in-visual-studio.md)
- [如何：在偵錯時切換到另一個執行緒](../debugger/how-to-switch-to-another-thread-while-debugging.md)

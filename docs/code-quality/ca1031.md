---
title: CA1031：不要攔截一般例外狀況類型
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1031
- DoNotCatchGeneralExceptionTypes
helpviewer_keywords:
- CA1031
- DoNotCatchGeneralExceptionTypes
ms.assetid: cbc283ae-2a46-4ec0-940e-85aa189b118f
author: jillre
ms.author: jillfra
manager: jillfra
dev_langs:
- CPP
- CSharp
- VB
ms.workload:
- multiple
ms.openlocfilehash: 5e754e0ac71adf419648ac9c6d0a16751aa4f752
ms.sourcegitcommit: c222052906362bf1a3762ec4d4623170e4e06702
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/04/2019
ms.locfileid: "74810028"
---
# <a name="ca1031-do-not-catch-general-exception-types"></a>CA1031：不要攔截一般例外狀況類型

|||
|-|-|
|TypeName|DoNotCatchGeneralExceptionTypes|
|CheckId|CA1031|
|Category|Microsoft. Design|
|重大變更|不中斷|

## <a name="cause"></a>原因
在 `catch` 語句中攔截到 <xref:System.Exception?displayProperty=fullName> 或 <xref:System.SystemException?displayProperty=fullName> 之類的一般例外狀況，或使用 `catch()` 之類的一般 catch 子句。

根據預設，此規則只會標示攔截到的一般例外狀況類型，但這是[可](#configurability)設定的。

## <a name="rule-description"></a>規則描述
不應該攔截一般例外狀況。

## <a name="how-to-fix-violations"></a>如何修正違規
若要修正此規則的違規情形，請攔截更特定的例外狀況，或重新擲回 [一般例外狀況] 做為 `catch` 區塊中的最後一個語句。

## <a name="when-to-suppress-warnings"></a>隱藏警告的時機
請勿隱藏此規則的警告。 攔截一般例外狀況類型可能會隱藏程式庫使用者的執行時間問題，而且可能會使調試更困難。

> [!NOTE]
> 從 .NET Framework 4 開始，common language runtime （CLR）不再提供作業系統和 managed 程式碼中發生的損毀狀態例外狀況，例如，[!INCLUDE[TLA#tla_mswin](../code-quality/includes/tlasharptla_mswin_md.md)]中的存取違規，以供 managed 程式碼處理。 如果您想要在 .NET Framework 4 或更新版本中編譯應用程式，並維護損毀狀態例外狀況的處理，您可以將 <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> 屬性套用至處理損毀狀態例外狀況的方法。

## <a name="configurability"></a>可設定性

如果您是從[FxCop 分析器](install-fxcop-analyzers.md)執行此規則（而不是使用舊版分析），此規則是可設定的。

### <a name="disallowed-exception-type-names"></a>不允許的例外狀況類型名稱

您可以設定不允許攔截到哪些例外狀況類型。 例如，若要指定規則應使用 `NullReferenceException`來旗標 `catch` 處理常式，請將下列機碼值組新增至專案中的 editorconfig 檔案：

```ini
dotnet_code_quality.CA1031.disallowed_symbol_names = NullReferenceException
```

選項值中允許的類型名稱格式（以 ' | ' 分隔）：
  - 僅限類型名稱（包含所有具有名稱的符號，不論包含的類型或命名空間為何）
  - 符號的[檔識別碼格式](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)中具有 `T:` 前置詞的完整限定名稱。

範例：

| 選項值 | 總結 |
| --- | --- |
|`dotnet_code_quality.CA1031.disallowed_symbol_names = ExceptionType` | 符合編譯中名為 ' ExceptionType ' 的所有符號
|`dotnet_code_quality.CA1031.disallowed_symbol_names = ExceptionType1|ExceptionType2` | 比對在編譯中名為 ' ExceptionType1 ' 或 ' ExceptionType2 ' 的所有符號
|`dotnet_code_quality.CA1031.disallowed_symbol_names = T:NS.ExceptionType` | 符合名為 ' ExceptionType ' 的特定類型與指定的完整名稱。
|`dotnet_code_quality.CA1031.disallowed_symbol_names = T:NS1.ExceptionType1|T:NS1.ExceptionType2` | 符合名為 ' ExceptionType1 ' 和 ' ExceptionType2 ' 的類型與個別的完整名稱

您可以只針對此規則、所有規則或此類別中的所有規則（設計）來設定這些選項。 如需詳細資訊，請參閱[設定 FxCop 分析器](configure-fxcop-analyzers.md)。

## <a name="example"></a>範例
下列範例顯示違反此規則的類型，以及可正確執行 `catch` 區塊的類型。

[!code-cpp[FxCop.Design.ExceptionAndSystemException#1](../code-quality/codesnippet/CPP/ca1031-do-not-catch-general-exception-types_1.cpp)]
[!code-vb[FxCop.Design.ExceptionAndSystemException#1](../code-quality/codesnippet/VisualBasic/ca1031-do-not-catch-general-exception-types_1.vb)]
[!code-csharp[FxCop.Design.ExceptionAndSystemException#1](../code-quality/codesnippet/CSharp/ca1031-do-not-catch-general-exception-types_1.cs)]

## <a name="related-rules"></a>相關規則
[CA2200：必須重新擲回以保存堆疊詳細資料](../code-quality/ca2200.md)

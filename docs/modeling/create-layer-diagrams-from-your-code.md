---
title: 從您的程式碼建立相依性圖表
description: 瞭解如何在 Visual Studio 中建立相依性圖表，以將您的軟體系統高層級邏輯架構視覺化。
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
helpviewer_keywords:
- architecture, dependency diagrams
- dependency diagrams
- diagrams - modeling, layer
- constraints, architectural
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: b07af93386d5062f28f19f01ce150fba8ec45dd2
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/19/2021
ms.locfileid: "112389653"
---
# <a name="create-dependency-diagrams-from-your-code"></a>從您的程式碼建立相依性圖表

若要以視覺化方式呈現您的軟體系統高層級邏輯架構，請在 Visual Studio 中建立相依性 *圖表* 。 為了確保您的程式碼與此設計保持一致，請使用相依性圖表驗證程式代碼。 您可以建立 Visual c # 和 Visual Basic 專案的相依性圖表。 若要查看 Visual Studio 支援這項功能的版本，請參閱 [架構和模型工具的版本支援](../modeling/what-s-new-for-design-in-visual-studio.md#edition-support-for-architecture-and-modeling-tools)。

![建立相依性圖表](../modeling/media/layerdiagramvisualizecode.png)

相依性圖表可讓您將 Visual Studio 方案專案組織為邏輯的抽象群組，稱為 *圖層*。 您可以使用圖層來說明這些成品所執行的工作，或系統的主要元件。 每個圖層都可以包含其他圖層以描述更詳細的工作。 您也可以指定圖 *層之間的* 預期或現有相依性。 這些表示為箭號的相依性，顯示哪些圖層可以使用或目前使用其他圖層代表的功能。 若要維持程式碼的架構控制，請在圖表上顯示預期的相依性，然後根據圖表驗證程式碼。

[影片：即時驗證您的架構相依性](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)

## <a name="create-a-dependency-diagram"></a><a name="CreateDiagram"></a> 建立相依性圖表

建立相依性圖表之前，請確定您的方案具有模型專案。

> [!IMPORTANT]
> 請勿將模型專案中的現有相依性圖表加入、拖曳或複製到另一個模型專案或方案中的另一個位置。 即使您變更圖表，此方式仍會保存原始圖表的參考。 這樣也會導致圖層驗證無法正確執行，同時可能會造成其他問題，例如項目遺失或嘗試開啟圖表時發生其他錯誤。
>
> 相反地，請將新的相依性圖表加入至模型專案。 將來源圖表中的項目複製到新圖表。 儲存模型專案和新的相依性圖表。

### <a name="add-a-new-dependency-diagram-to-a-modeling-project"></a>將新的相依性圖表加入至模型專案

> [!NOTE]
> 從 Visual Studio 2019 16.2 版開始支援 .NET Core 專案的相依性圖表。

1. 在 [ **架構** ] 功能表上，選擇 [新增相依性 **圖表**]。

2. 在 [ **範本**] 底下，選擇 [相依性 **圖表**]。

3. 命名圖表。

4. 在 [ **加入至模型專案**] 中，流覽至方案中的現有模型專案並加以選取。

     -或-

     選擇 [ **建立新的模型專案** ]，將新的模型專案加入至方案。

    > [!NOTE]
    > 相依性圖表必須存在於模型專案內。 但是，您可以將它連結到方案中任何位置的項目。

5. 請務必儲存模型專案和相依性圖表。

## <a name="drag-and-drop-or-copy-and-paste-from-a-code-map"></a>從 Code Map 拖放或複製並貼上

1. 使用 [ **架構** ] 功能表產生方案的 Code Map。

2. 如果您只想要在產品程式碼中強制執行相依性，請考慮套用 Code Map 篩選來移除方案資料夾和「測試資產」。

3. 根據您是否要強制執行命名空間相依性，並從 Code Map 刪除非必要的元件，在產生的 Code Map 上移除 "External" 節點，或展開它以顯示外部元件。

4. 使用 [ **架構** ] 功能表為方案建立新的相依性圖表

5. 選取 Code Map 上的所有節點 (使用 _Ctrl_  +  _A_，或是按下 _Shift_ 鍵，然後按下 Shift 鍵，然後按一下、拖曳和放開，以使用 [選取]。

6. 將選取的元素拖放或複製並貼上至新的相依性驗證圖表。

7. 這會顯示目前的應用程式架構。 決定您想要架構的內容，並據此修改相依性圖表。

![從 Code Map 產生的相依性圖表](media/dependency-validation-01.png)

## <a name="create-layers-from-artifacts"></a><a name="CreateLayers"></a> 從成品建立圖層
 您可以從 Visual Studio 方案項目 (例如，專案、程式碼檔、命名空間、類別和方法) 建立圖層。 這樣會自動建立這些圖層和項目之間的連結，將這些項目納入圖層驗證程序中。

 您也可以將圖層連結至不支援驗證的項目，例如 Word 文件或 PowerPoint 簡報，使您可以將圖層與規格或計劃連結。 您也可以將圖層連結至多個應用程式所共用的專案檔案，但驗證程序不會包含這些以泛型名稱顯示的圖層，例如「Layer 1」和「Layer 2」。

 若要查看連結的專案是否支援驗證，請開啟 [ **圖層瀏覽器** ]，然後檢查項目的 [ **支援驗證** ] 屬性。 請參閱管理成品的 [連結](#Managing)。

|**若要**|**請依照下列步驟：**|
|-|-|
|建立單一成品的圖層|<ol><li>將專案從下列來源拖曳至相依性圖表：<br /><br /> <ul><li>**方案總管**<br /><br />         例如，您可以拖曳檔案或專案。</li><li>Code Map<br /><br />         請參閱 [對應您解決方案](../modeling/map-dependencies-across-your-solutions.md) 的相依性，並 [使用 code map 來對應用程式進行偵錯工具](../modeling/use-code-maps-to-debug-your-applications.md)。</li><li>**類別檢視** 或 **物件瀏覽器**</li></ul><br />     圖層會出現在圖表上，並且連結到成品。</li><li>重新命名圖層以反映相關程式碼或成品的責任。</li></ol> **重要事項：**  將二進位檔案拖曳至相依性圖表時，不會自動將參考加入至模型專案。 您必須手動加入您要驗證模型專案的二進位檔案。 **若要將二進位檔案加入至模型專案** <ol><li>在 **方案總管** 中，開啟模型專案的快捷方式功能表，然後選擇 [ **加入現有專案**]。</li><li>在 [ **加入現有專案** ] 對話方塊中，流覽至二進位檔案，選取它們，然後選擇 **[確定]**。     二進位檔案會出現在模型專案中。</li><li>在 **方案總管** 中，選擇您加入的二進位檔案，然後按 **F4** 開啟 [ **屬性** ] 視窗。</li><li>在每個二進位檔案上，將 [ **組建動作** ] 屬性設定為 [ **驗證**]。</li></ol>|
|為所有選取的成品建立單一圖層|同時將所有成品拖曳至相依性圖表。<br /><br /> 圖層隨即出現在圖表上，並且連結到所有成品。|
|為每個選取的成品建立圖層|當您同時將所有成品拖曳至相依性圖表時，請按住 **SHIFT** 鍵。 **注意：**  如果您使用 **SHIFT** 鍵來選取某個範圍的專案，請在選取成品之後釋放金鑰。 將成品至拖曳圖表時，再次按住該鍵不放。 <br /><br /> 每個成品的圖層隨即出現在圖表上，並且連結到個別成品。|
|將成品加入至圖層|將成品拖曳至圖層。|
|建立新的未連結圖層|在 [ **工具箱**] 中，展開 [相依性 **圖表** ] 區段，然後將 **圖層** 拖曳至相依性圖表。<br /><br /> 若要加入多個圖層，請按兩下 [圖層] 工具。 當您完成時，請選擇 [ **指標** ] 工具，或按 **ESC** 鍵。<br /><br /> - 或 -<br /><br /> 開啟相依性圖表的快捷方式功能表，選擇 [ **加入**]，然後選擇 [ **圖層**]。|
|建立巢狀圖層|將現有的圖層拖曳至另一個圖層上。<br /><br /> - 或 -<br /><br /> 開啟圖層的快捷方式功能表，選擇 [ **加入**]，然後選擇 [ **圖層**]。|
|建立包含兩個或多個現有圖層的新圖層|選取圖層，開啟您選取專案的快捷方式功能表，然後選擇 [ **群組**]。|
|變更圖層的色彩|將其 [ **色彩** ] 屬性設定為您想要的色彩。|
|指定與圖層關聯的成品不可屬於指定的命名空間|在圖層的 [禁止的 **命名空間** ] 屬性中輸入命名空間。 使用分號 (**;**) 來分隔命名空間。|
|指定與圖層關聯的成品不可相依於指定的命名空間|在圖層的 [禁止的 **命名空間** 相依性] 屬性中輸入命名空間。 使用分號 (**;**) 來分隔命名空間。|
|指定與圖層關聯的成品必須屬於其中一個指定的命名空間|在圖層的 [必要的 **命名空間** ] 屬性中輸入命名空間。 使用分號 (**;**) 來分隔命名空間。|

 圖層上的數字表示圖層連結的成品數目。 然而，當您閱讀這個數字時，請記住下列各項：

- 如果圖層連結的成品有包含其他成品，但圖層未直接連結這些其他成品，則數字將只包含連結的成品。 然而，在圖層驗證期間會加入其他成品以進行分析。

     例如，如果圖層連結到單一命名空間，即使命名空間包含類別，連結的成品數目仍為 1。 如果圖層也有命名空間中每個類別的連結，則數字將包含這些已連結的類別。

- 如果圖層包含已連結到成品的其他圖層，即使此容器圖層上的數字未包含那些成品，容器圖層也會連結到那些成品。

## <a name="manage-links-between-layers-and-artifacts"></a><a name="Managing"></a> 管理圖層和構件之間的連結

1. 在相依性圖表上，開啟圖層的快捷方式功能表，然後選擇 [ **View Links**]。

     **圖層 Explorer** 會顯示所選圖層的成品連結。

2. 使用下列工作來管理這些連結：

|**若要**|**在圖層總管中**|
|-|-|
|刪除圖層與成品之間的連結|開啟成品連結的快捷方式功能表，然後選擇 [ **刪除**]。|
|將連結從某個圖層移到另一個圖層|將成品連結拖曳至圖表上的現有圖層。<br /><br /> - 或 -<br /><br /> 1. 開啟成品連結的快捷方式功能表，然後選擇 [ **剪** 下]。<br />2. 在相依性圖表上，開啟圖層的快捷方式功能表，然後選擇 [ **貼** 上]。|
|將連結從某個圖層複製到另一個圖層|1. 開啟成品連結的快捷方式功能表，然後選擇 [ **複製**]。<br />2. 在相依性圖表上，開啟圖層的快捷方式功能表，然後選擇 [ **貼** 上]。|
|從現有的成品連結建立新的圖層|將成品連結拖曳至圖表上的空白區域。|
|確認連結的成品支援對相依性圖表進行驗證。|查看成品連結的 [ **支援驗證** ] 資料行。|

## <a name="reverse-engineer-existing-dependencies"></a><a name="Discovering"></a> 對現有相依性進行反向工程
 只要與某個圖層關聯的成品參考到與另一個圖層關聯的成品，相依性便會存在。 例如，某個圖層中的類別會宣告在另一個圖層中具有類別的變數。 對於連結到圖表上之圖層的成品，您可以就其現有相依性進行反向工程。

> [!NOTE]
> 您無法針對特定種類的成品進行其相依性的反向工程。 例如，對連結到文字檔的圖層進行反向工程時，無法找出與該圖層之間的任何相依性。 若要查看哪些成品有您可以進行反向工程的相依性，請開啟一個或多個圖層的快捷方式功能表，然後選擇 [ **View Links**]。 在 [ **圖層瀏覽器**] 中，檢查 [ **支援驗證** ] 資料行。 相依性不會針對此資料行顯示為 **False** 的成品進行反向工程。

- 選取一或多個圖層，開啟所選圖層的快捷方式功能表，然後選擇 [產生相依性 **]**。

  通常，您會看到一些不應該存在的相依性。 您可以編輯這些相依性，以便與預期的設計保持一致。

## <a name="edit-layers-and-dependencies-to-show-the-intended-design"></a><a name="EditDependencies"></a> 編輯圖層和相依性以顯示預期的設計
 若要描述您打算對系統或預期架構進行的變更，請編輯相依性圖表：

|**若要**|**執行這些步驟**|
|-|-|
|變更或限制相依性的方向|設定其 **Direction** 屬性。|
|建立新的相依性|使用相依 **性** 和 **雙向** 相依性工具。<br /><br /> 若要繪製多個相依性，請按兩下工具。 當您完成時，請選擇 [ **指標** ] 工具，或按 **ESC** 鍵。|
|指定與圖層關聯的成品不可相依於指定的命名空間|在圖層的 [禁止的 **命名空間** 相依性] 屬性中輸入命名空間。 使用分號 (**;**) 來分隔命名空間。|
|指定與圖層關聯的成品不可屬於指定的命名空間|在圖層的 [禁止的 **命名空間** ] 屬性中輸入命名空間。 使用分號 (**;**) 來分隔命名空間。|
|指定與圖層關聯的成品必須屬於其中一個指定的命名空間|在圖層的 [必要的 **命名空間** ] 屬性中輸入命名空間。 使用分號 (**;**) 來分隔命名空間。|

## <a name="change-how-elements-appear-on-the-diagram"></a><a name="EditLayout"></a> 變更元素出現在圖表上的方式
 您可以藉由編輯屬性的方式，變更圖層的大小、圖形、色彩和位置，或相依性的色彩。

## <a name="discover-patterns-and-dependencies-on-a-code-map"></a><a name="Codemaps"></a> 探索 code map 的模式和相依性
 建立相依性圖表時，您也可以建立 **code map**。 這些圖表可協助您在瀏覽程式碼時探索模式和相依性。 使用 [方案總管]、[類別檢視] 或 [物件瀏覽器] 瀏覽組件、命名空間和類別 (這通常會正確對應至現有的圖層)。 如需 Code Map 的詳細資訊，請參閱：

- [對應方案之間的相依性](../modeling/map-dependencies-across-your-solutions.md)

- [使用 Code Map 偵錯您的應用程式](../modeling/use-code-maps-to-debug-your-applications.md)

- [使用 Code Map 分析器尋找潛在問題](../modeling/find-potential-problems-using-code-map-analyzers.md)

## <a name="see-also"></a>另請參閱

- [架構和模型工具的版本支援](../modeling/what-s-new-for-design-in-visual-studio.md#edition-support-for-architecture-and-modeling-tools)
- [影片：即時驗證您的架構相依性](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)
- [相依性圖表︰參考](../modeling/layer-diagrams-reference.md)
- [相依性圖表︰方針](../modeling/layer-diagrams-guidelines.md)
- [使用相依性圖表驗證程式碼](../modeling/validate-code-with-layer-diagrams.md)
- [視覺化程式碼](../modeling/visualize-code.md)

---
title: 分析 .NET 物件的記憶體使用方式 |微軟文檔
ms.date: 12/9/2019
ms.topic: conceptual
helpviewer_keywords:
- memory allocation, memory usage
author: Sagar-S-S
ms.author: sashe
manager: AndSter
ms.workload:
- multiple
ms.openlocfilehash: 9518ffd618a6d82505feca33b37b5151a3a9f961
ms.sourcegitcommit: cc841df335d1d22d281871fe41e74238d2fc52a6
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/18/2020
ms.locfileid: "75898466"
---
# <a name="analyze-memory-usage-using-the-net-object-allocation-tool"></a>使用 .NET 物件分配工具分析記憶體使用方式

您可以使用 .NET 物件分配工具查看應用正在使用的記憶體量以及哪些代碼路徑分配了最多的記憶體。

運行該工具後，您可以看到正在分配物件的函數執行路徑，以便您可以追溯到佔用最大記憶體的調用樹的根目錄。

## <a name="setup"></a>安裝程式

1. 在視覺工作室中打開性能探測器 **（Alt + F2）。**
2.  選擇 **.NET 物件分配跟蹤**核取方塊。

![直徑中心](../profiling/media/diaghub.png "直徑中心")

> [!NOTE]
> 預設情況下，啟動專案選擇為 **"分析目標**"，但可以通過打開 **"更改目標"** 下拉式功能表然後從可用選項中選擇，將此選項更改為正在運行的進程、可執行檔、正在運行的應用和已安裝的應用。

   .NET 物件分配工具當前不支援通過下拉式功能表執行檔。 您必須通過 exe 專案系統才能使用該工具。 要關閉當前解決方案（**檔** -> **關閉解決方案**），然後點擊 **"檔** -> **打開專案或解決方案**->選擇 .exe 檔。

![分析目標](../profiling/media/analysistarget.png "分析目標")

3. 按一下"**開始"** 按鈕以運行該工具。

![停止收集](../profiling/media/stopcollection.png "停止收集")

4. 工具開始運行後，在應用中完成所需的方案，然後按 **"停止收集"** 或關閉應用以查看資料。
5. 按一下"**分配"** 選項卡，您應該會看到類似于下圖的圖像。

![配置](../profiling/media/allocation.png "配置")

恭喜！ 您現在可以分析物件的記憶體分配。

## <a name="understand-your-data"></a>瞭解您的資料

### <a name="collection"></a>集合

![收集](../profiling/media/collection.png "集合")

通過收集視圖，您可以查看垃圾回收期間收集的物件數以及保留的物件數。 此視圖還提供一些圓形圖，以便按類型視覺化收集和存活的物件。

- "**收集"** 列顯示垃圾回收器收集的物件數。
- "**倖存"** 列顯示運行垃圾回收器後存活的物件數。

### <a name="allocation"></a>配置

![分配擴展](../profiling/media/allocationexpanded.png "分配擴展")

分配視圖允許您查看正在分配記憶體的物件的位置以及這些物件分配的記憶體量。

- **"Name"** 列是佔用記憶體的各種類和結構的清單。 列中的每個項都是一個節點，如果該類別中有佔用記憶體的項，則可以展開該節點。 （僅限**分配**視圖）
- "**總計（分配）"** 列顯示佔用記憶體的特定分配類型中的物件數。 （**分配**、**調用樹**和**函數**視圖）
- **Self（分配）** 列顯示佔用記憶體的單個項中的物件數。 （**分配**、**調用樹**和**函數**視圖）
- 這三列都是可排序的。 在 **"名稱"** 列中，項按字母順序排序（向前或向後）。 對於 **"總計**"和 **"自"（分配），** 您可以按數位排序（以數位數或遞減方式排序）。
- 預設情況下 **，總大小（位元組）** 和**自大（位元組）** 列不打開。 要啟用它們，請按右鍵 **"名稱**、**總計**"或 **"自分配"** 列，然後按一下 **"總大小**和**自大"** 選項以將其添加到圖表中。 這兩列與**Total（分配）** 和**自（分配）** 類似，只不過它們不是顯示佔用記憶體的物件數，而是顯示這些物件正在佔用的以位元組為單位的記憶體總量。 [僅限分配視圖]

### <a name="call-tree"></a>調用樹

![調用樹](../profiling/media/calltree.png "調用樹")

**調用樹**視圖允許您查看包含分配大量記憶體的物件的函數執行路徑。

- **函數名稱**列顯示包含基於要檢查的節點級別分配記憶體的物件的函數的進程或名稱。
- **"總計****"和"自分配"** 列顯示的資訊與 **"分配"** 視圖相同。
- **"模組名稱**"列顯示包含正在調用的函數或進程的模組。

![熱路徑](../profiling/media/hotpath.png "最忙碌路徑")

- **"展開熱路徑"** 按鈕突出顯示包含大量分配記憶體的物件的函數執行路徑。 該演算法從使用者選擇的感興趣節點開始，並突出顯示大多數分配的路徑，指導使用者進行調查。
- "**顯示熱路徑"** 按鈕在火焰圖示上切換，指示哪個節點是**熱路徑**的一部分。

### <a name="functions"></a>函式

![函式](../profiling/media/functions.png "函式")

**"函數"** 視圖顯示分配記憶體的進程、模組和函數。

- "**名稱**"列將進程顯示為最高級別的節點。 流程下面是模組，模組下面是功能。
- **"總計****"和"自分配"** 列顯示的資訊與 **"分配"** 視圖相同。

**分配**、**調用樹**和**函數**視圖都包含 **"僅顯示我的代碼**"、**顯示本機代碼**和**搜索**選項：

![篩檢程式欄](../profiling/media/filterbar.png "篩檢程式欄")

- **"僅顯示我的代碼**"會將系統、框架和其他非使用者代碼折疊到 **[外部代碼]** 幀中，以便使用者代碼可以專注于這些框架。 有關詳細資訊，請參閱[使用"我的代碼"調試使用者代碼](../debugger/just-my-code.md)。
- **顯示本機代碼**顯示分析目標中的本機代碼，如果選中，包括非使用者代碼。
- "**篩選器"框**允許您根據提供的參數篩選下 **"名稱**"或 **"函數名稱**"列。 只需在欄位中鍵入，表應向下篩選以僅顯示包含提供的字串的類型。

---
title: 分析 .NET 物件的記憶體使用量 |Microsoft Docs
ms.date: 12/9/2019
ms.topic: conceptual
helpviewer_keywords:
- memory allocation, memory usage
author: Sagar-S-S
ms.author: sashe
manager: AndSter
ms.workload:
- multiple
ms.openlocfilehash: 9518ffd618a6d82505feca33b37b5151a3a9f961
ms.sourcegitcommit: aa302af53de342e75793bd05b10325939dc69b53
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/11/2020
ms.locfileid: "75898466"
---
# <a name="analyze-memory-usage-using-the-net-object-allocation-tool"></a>使用 .NET 物件組態工具分析記憶體使用量

您可以查看您的應用程式正在使用多少記憶體，以及使用 .NET 物件組態工具配置最多記憶體的程式碼路徑。

執行此工具之後，您可以看到正在設定物件的函式執行路徑，讓您可以追蹤回到佔用最多記憶體的呼叫樹狀結構的根目錄。

## <a name="setup"></a>安裝程式

1. 在 Visual Studio 中開啟 [效能分析工具] （**Alt + F2）** 。
2.  選取 [ **.Net 物件配置追蹤**] 核取方塊。

![診斷中樞](../profiling/media/diaghub.png "診斷中樞")

> [!NOTE]
> 預設會選取 [啟始] 專案做為**分析目標**，但可以藉由開啟 [**變更目標**] 下拉式功能表，然後從可用的選項中進行選取，將其變更為執行中的進程、執行中的應用程式和已安裝的應用程式。

   .NET 物件組態工具目前不支援透過下拉式功能表的可執行檔。 您必須經過 exe 專案系統，才能使用此工具。 若要這麼做，請關閉目前的**方案（檔案** -> **關閉方案**），**然後點擊 [** 檔案] -> **開啟專案或方案**-> 選取 .exe 檔案。

![分析目標](../profiling/media/analysistarget.png "分析目標")

3. 按一下 [**啟動**] 按鈕以執行工具。

![停止收集](../profiling/media/stopcollection.png "停止收集")

4. 工具開始執行之後，請在您的應用程式中完成所需的案例，然後按下 [**停止收集**] 或關閉您的應用程式，以查看您的資料。
5. 按一下 [**配置**] 索引標籤，您應該會看到類似下面所示的影像。

![配置](../profiling/media/allocation.png "配置")

恭喜！ 您現在可以分析物件的記憶體配置。

## <a name="understand-your-data"></a>瞭解您的資料

### <a name="collection"></a>集合

![集合](../profiling/media/collection.png "集合")

[集合] 視圖可讓您查看垃圾收集期間所收集的物件數目，以及保留的數目。 這個視圖也提供幾個圓形圖，可依類型將所收集和存活的物件視覺化。

- [**收集**的資料行] 會顯示垃圾收集行程收集的物件數目。
- [已**存活**] 資料行會顯示在執行垃圾收集行程之後，被回收的物件數目。

### <a name="allocation"></a>配置

![已擴充配置](../profiling/media/allocationexpanded.png "已擴充配置")

[配置] 視圖可讓您查看物件的位置，這些物件會配置記憶體，以及這些物件所配置的記憶體數量。

- [**名稱**] 資料行是佔用記憶體之各種類別和結構的清單。 此資料行內的每個專案都是一個節點，如果該類別中有專案佔用記憶體，就可以展開該節點。 （僅限**配置**視圖）
- [**總計（配置）** ] 資料行會顯示特定配置類型中佔用記憶體的物件數目。 （**配置**、**呼叫樹狀結構**和**函數**視圖）
- [**本身（配置）** ] 資料行會顯示個別專案中佔用記憶體的物件數目。 （**配置**、**呼叫樹狀結構**和**函數**視圖）
- 這三個數據行都是可排序的。 在 [**名稱**] 資料行的案例中，專案會依字母順序（向前或向後）排序。 對於**Total**和**Self （配置）** ，您可以依數位順序排序（逐漸增加或 decreasingly）。
- 預設不會開啟 [**總大小（位元組）** ] 和 [**自我大小（位元組）** ] 資料行。 若要啟用它們，請以滑鼠右鍵按一下 [**名稱**]、[**總計**] 或 [**本身（配置）** ] 資料行，然後按一下 [**大小總計**] 和 [**自我大小**] 選項，將它們加入圖表中。 這兩個數據行與 **[總（配置）** ] 和 **[本身（配置）** ] 相似，不同之處在于，它會顯示物件佔用的記憶體總量（以位元組為單位）。 [僅限配置視圖]

### <a name="call-tree"></a>呼叫樹狀結構

![呼叫樹狀結構](../profiling/media/calltree.png "呼叫樹狀結構")

[**呼叫樹**視圖] 可讓您查看包含配置大量記憶體之物件的函式執行路徑。

- [函式**名稱**] 資料行會顯示函式的進程或名稱，其中包含的物件會根據您要檢查的節點層級來配置記憶體。
- [**總計**] 和 [**自我（配置）** ] 資料行顯示的資訊與**配置**視圖相同。
- [**模組名稱**] 資料行會顯示模組，其中包含正在呼叫的函式或進程。

![最忙碌路徑](../profiling/media/hotpath.png "最忙碌路徑")

- [**展開**最忙碌路徑] 按鈕會反白顯示函數執行路徑，其中包含許多正在配置記憶體的物件。 此演算法會從使用者選取的感興趣節點開始，並反白顯示大部分配置的路徑，引導使用者進行調查。
- [**顯示**最忙碌路徑] 按鈕會開啟或關閉火焰圖示，指出哪一個節點是最忙碌**路徑**的一部分。

### <a name="functions"></a>功能

![函式](../profiling/media/functions.png "功能")

[**函數**] 視圖會顯示配置記憶體的進程、模組和函式。

- [**名稱**] 資料行會將進程顯示為最高層級節點。 [進程] 底下是模組，而 [模組] 為 [函數]。
- [**總計**] 和 [**自我（配置）** ] 資料行顯示的資訊與**配置**視圖相同。

配置 **、** **呼叫樹狀** 和 **函數** views 全都包含 **顯示 Just My Code**、**顯示機器碼**和**搜尋**選項：

![篩選列](../profiling/media/filterbar.png "篩選列")

- **顯示 Just My Code**折迭系統、架構和其他非使用者程式碼，以及 **[外部程式碼]** 框架，讓使用者程式碼可以專注于。 如需詳細資訊，請參閱[使用 Just My Code 的 Debug 使用者程式碼](../debugger/just-my-code.md)。
- [**顯示機器碼**] 顯示分析目標內的機器碼，包括非使用者程式碼（如果已選取）。
- [**篩選**] 方塊可讓您根據所提供的參數，篩選出 [**名稱**] 或 [函式**名稱**] 資料行。 只需在欄位中輸入，資料表應該會向下篩選，只顯示包含所提供字串的類型。

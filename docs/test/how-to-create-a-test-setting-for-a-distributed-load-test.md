---
title: 建立分散式負載測試的測試設定
description: 瞭解如何設定負載測試的測試設定，讓您可以使用測試代理程式和測試控制器將這些測試分散到多部電腦。
ms.custom: SEO-VS-2020
ms.date: 10/19/2016
ms.topic: how-to
helpviewer_keywords:
- test settings, for distributed load tests
ms.assetid: b63d4b71-3b74-4872-b2d1-f0bd1a9a8544
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: b52fad24cf0772099e619b08ad877bae891365c3
ms.sourcegitcommit: 02f14db142dce68d084dcb0a19ca41a16f5bccff
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/23/2020
ms.locfileid: "95439962"
---
# <a name="how-to-create-a-test-settings-file-for-a-distributed-load-test"></a>如何：建立分散式負載測試的測試組態檔案

為您的負載測試設定「測試設定」，如此您可以使用測試代理程式和測試控制器將這些測試散佈到多部電腦。 您還可以使用「診斷資料配接器」設定測試設定，該配接器會指定要收集的資料種類，或指定從 Visual Studio 執行負載測試時如何影響測試電腦。

[!INCLUDE [web-load-test-deprecated](includes/web-load-test-deprecated.md)]

例如，您可以使用 ASP.NET 分析工具診斷資料配接器收集程式碼的效能解析。 此外，診斷資料配接器可以用來模擬測試電腦上的可能瓶頸，或減少可用的系統記憶體。

Visual Studio 的測試設定會儲存在檔案中。 測試設定會定義有關每個角色的下列資訊：

- 待測應用程式需要的角色集

- 要用來執行測試的角色

- 要針對每個角色使用的診斷資料配接器

當您執行測試時，視特定測試回合的需要來選取做為作用中測試設定的測試設定。 將測試設定檔做為方案的一部分儲存。 檔案名稱的副檔名是 *.testsettings*。

當您將 web 效能和負載測試專案加入至方案時，會建立 *.testsettings* 檔案。 這個檔案會自動新增至方案的 [方案項目] 資料夾底下。 這個檔案會在本機上執行您的測試，不需要任何診斷資料配接器。 您可以新增另一個 *.testsettings* 檔案，或是編輯 *.testsettings* 檔案以指定診斷資料配接器和測試控制器。

測試控制器將具有可用於測試設定中每一個角色的代理程式。 如需測試控制器和測試代理程式的詳細資訊，請參閱[使用 Visual Studio 管理測試控制器和測試代理程式](../test/manage-test-controllers-and-test-agents.md)。

請遵循下列程序，針對您計劃從 Visual Studio 執行的負載測試，在方案中建立和移除測試設定。

## <a name="create-a-test-settings-file"></a>建立測試設定檔

1. 在 **方案總管** 中，以滑鼠右鍵按一下 [ **方案專案**]，指向 [ **加入**]，然後選擇 [ **新增專案**]。

     [加入新項目]  對話方塊隨即出現。

2. 在 [安裝的範本] 窗格中，選擇 [測試設定]。

3. (選擇性) 在 [名稱] 方塊中，變更測試設定檔的名稱。

4. 選擇 [新增]  。

     新的測試組態檔會出現在 [**方案專案**] 資料夾下的 **方案總管** 中。

5. [測試設定] 對話方塊隨即顯示。 已選取 [一般] 頁面。

     接著，便可以編輯和儲存測試設定值。

6. 在 [名稱] 下方鍵入測試設定的名稱。

7. (選擇性) 在 [描述] 下方鍵入測試設定的描述，讓其他小組成員可了解其用途。

8. (選擇性) 若要選取測試回合的預設命名配置，請選取 [預設命名配置]。 若要定義您自己的命名配置，請選取 [使用者定義的配置]，然後在 [前置詞文字] 中鍵入您想要的文字。 若要將日期和時間戳記附加至測試回合名稱，請選取 [附加日期時間戳記]。

9. 選擇 **[角色]**。

     [角色] 頁面隨即顯示。

     ![測試設定角色](../test/media/load_testtestrole.png)

10. 若要從遠端執行測試，或是從遠端執行測試並且從遠端收集資料，請使用 [測試執行方法] 下拉式清單並選取 [遠端執行]。

11. 使用 [控制器] 下拉式清單可針對測試代理程式，從 [控制器] 選取將用於執行測試或收集資料的測試控制器。

    > [!NOTE]
    > 如果這是您第一次加入控制器，則下拉式清單不會列出任何控制器。 您先前在其他測試設定中指定的控制器會填入此清單中。 您必須在方塊中鍵入控制器的名稱 (例如 **TestControllerMachine1**)。

12. 若要新增您想要用來執行測試和收集資料的角色，請選擇 [角色] 底下的 [新增]。

13. 在 [名稱] 欄中鍵入角色的名稱。 例如，角色可以是「Web 伺服器」。

14. 重複步驟 12 和 13，加入您需要的所有角色。

     每個角色都會使用測試控制器所管理的測試代理程式。

15. 選取您要用以執行測試的角色，然後選擇 [設定為執行測試的角色]。

    > [!IMPORTANT]
    > 您所建立和定義的其他角色將不會執行測試，而是只會根據您在 [資料和診斷] 頁面中針對角色所指定的資料和診斷配接器，用來收集資料。

16. 若要限制可用於角色的代理程式，請選取角色，然後在 [**所選角色的代理程式屬性**] 下，選擇工具列中的 [**加入**]。

     [代理程式選取規則] 對話方塊隨即顯示。

     在 [屬性名稱] 中鍵入名稱，並且在 [屬性值] 中鍵入值，然後選擇 [確定]。 盡可能多地加入您需要的屬性。

     例如，您可以加入名為 "RAM > 16GB" 且值為 "True" 或 "False" 的屬性，以便篩選具備 16 GB 以上記憶體的測試代理程式電腦。 若要將相同的屬性套用至一或多個測試代理程式，請使用 [管理測試控制器] 對話方塊。 如需詳細資訊，請參閱[使用 Visual Studio 管理測試控制器和測試代理程式](../test/manage-test-controllers-and-test-agents.md)。

17. 選擇 [資料和診斷]。

     [資料和診斷] 頁面隨即顯示。

     ![測試設定資料和診斷](../test/media/load_testtest.png)

18. 在 [資料和診斷] 頁面中，您可以選取角色用來收集資料的「診斷資料配接器」，藉以定義角色的行為。 因此，如果您針對角色啟用了一個或多個資料和診斷配接器，則測試控制器將會選取可用的測試代理程式電腦，根據您針對角色定義的屬性收集指定之資料和診斷配接器的資料。 若要選取您要為每個角色收集的資料和診斷資料配接器，請選取角色。 針對每個角色，根據各項測試的需求，選取診斷資料配接器。 若要設定您已為每個角色選取的診斷資料配接器，請選擇 [設定]。

     **角色和診斷資料配接器的範例：**

     例如，您可以建立名為 "Desktop Client" 且 "Uses SQL" 屬性設定為 "True" 的用戶端角色，以及名為 "SQL Server" 且屬性設定為 "RAM > 16GB" 的伺服器角色。 如果您在 [角色] 頁面中選擇 [設定為執行測試的角色]，藉以指定 "Desktop Client" 將執行測試，則測試控制器將會選取其測試代理程式之 "Uses SQL" 屬性設定為 "True" 的電腦來執行測試。 此外，測試控制器也會選取其測試代理程式只含有 "RAM > 16GB" 屬性的 SQL Server 電腦，以便收集該角色所包含之資料和診斷配接器所定義的資料。 "Desktop Client" 測試代理程式也可以收集執行所在電腦的資料 (如果您也針對該角色選取資料和診斷配接器的話)。

     如需每個診斷資料配接器和其設定方式的詳細資料，您可以檢視下表中的相關主題。

     如需診斷資料配接器的詳細資訊，請參閱 [使用測試設定收集診斷資訊](../test/collect-diagnostic-information-using-test-settings.md)。

     **適用於負載測試的診斷資料配接器**

    |診斷資料配接器|在負載測試中使用|相關主題|
    |-|-------------------------|-|
    |**適用于 IntelliTrace 和測試影響的 ASP.NET 用戶端 Proxy：** 此 proxy 可讓您針對 IntelliTrace 和測試影響診斷資料配接器，收集從用戶端到 web 伺服器之 HTTP 呼叫的相關資訊。|![資訊圖示](../test/media/vc364f4.gif)<br /><br /> 除非您有特定需要，必須收集測試代理程式電腦的系統資訊，否則不要包含此配接器。 **注意：** 我們不建議您在負載測試中使用 IntelliTrace 配接器，因為會因收集大量資料而發生問題。 <br /><br /> 使用負載測試不會收集測試影響資料。||
    |**IntelliTrace：** 您可以設定以記錄檔儲存的特定診斷追蹤資訊。 記錄檔具有 *.tdlog* 副檔名。 在您執行測試時，若測試步驟失敗，您可以建立 Bug。 包含診斷追蹤的記錄檔會自動附加至此 Bug 中。 記錄檔中收集的資料可縮短重現及診斷程式碼錯誤所需的時間，進而提高偵錯的效能。 使用這個記錄檔，就可以在另一部電腦上重新建立本機工作階段。 這樣可降低無法重現 Bug 的風險。<br /><br /> 如需詳細資訊，請參閱[收集 IntelliTrace 資料](../test/how-to-collect-intellitrace-data-to-help-debug-difficult-issues.md)。|![重要圖示](../test/media/vc364f3.gif)<br /><br /> 我們不建議您在負載測試中使用 IntelliTrace 配接器，因為會因收集和記錄大量資料而發生問題。 您應該僅在執行時間短，且不會使用許多測試代理程式的負載測試中嘗試使用 IntelliTrace 配接器。|[如何：收集 IntelliTrace 資料以協助偵錯困難的問題](../test/how-to-collect-intellitrace-data-to-help-debug-difficult-issues.md)|
    |**ASP.NET Profiler：** 您可以建立包含 ASP.NET 分析的測試設定，它會收集 ASP.NET web 應用程式的效能資料。|ASP.NET 分析工具診斷資料配接器會分析 Internet Information Services (IIS) 處理序，因此不會針對開發網頁伺服器執行。 若要在負載測試中分析網站，您必須在 IIS 執行所在的電腦上安裝測試代理程式。 測試代理程式不會產生負荷，而是只進行收集的代理程式。 如需詳細資訊，請參閱[安裝和設定測試代理程式](../test/lab-management/install-configure-test-agents.md)。|[如何：使用測試設定為負載測試設定 ASP.NET profiler](../test/how-to-configure-aspnet-profiler-for-load-tests-using-test-settings.md)|
    |**事件記錄檔：** 您可以設定測試設定來包含事件記錄檔收集 (該事件記錄檔收集是包含在測試結果中)。||[如何：使用測試設定來設定事件記錄檔收集](/previous-versions/dd504816(v=vs.110))|
    |**網路模擬：** 您可以使用測試設定指定要對測試加上人為的網路負載。 網路模擬可藉由模擬特定網路連線速度 (如撥號連線)，對電腦的對外通訊產生影響。 **注意：** 網路模擬無法用以增加網路連線速度。|負載測試會忽略網路模擬配接器。 因為負載測試會改用負載測試情節的網路混合中指定的設定。<br /><br /> 如需詳細資訊，請參閱[指定虛擬網路類型](../test/specify-virtual-network-types-in-a-load-test-scenario.md)。||
    |**系統資訊：** 測試設定可設定為包含系統資訊診斷和資料收集器執行所在電腦的相關系統資訊。 透過測試設定，系統資訊會指定於測試結果中。|![資訊圖示](../test/media/vc364f4.gif)<br /><br /> 您可以同時從負載代理程式和待測系統收集系統資訊。|不需任何設定，即可收集這項資訊。|
    |**測試影響：** 您可以收集在測試案例執行時，應用程式程式碼使用了哪些方法的相關資訊。 您可以將這項資訊對照開發人員對應用程式程式碼所做的變更，判斷有哪些測試受到這些開發變更的影響。|負載測試不會收集測試影響資料。||
    |**視訊錄製器：** 您可以在執行自動化測試時，建立桌面工作階段的視訊錄製。 這在檢視自動程式碼 UI 測試的使用者動作時可能很有用。 視訊可協助其他小組成員找出難以重現的應用程式問題。 **注意：** 遠端執行測試時，除非代理程式以互動式處理序模式執行，否則視訊錄製器將無法運作。|![重要圖示](../test/media/vc364f3.gif) **警告：** 不建議使用視訊錄製器配接器進行負載測試。|[如何：使用測試設定在測試期間包含螢幕和聲音錄製](../test/how-to-include-recordings-of-the-screen-and-voice-during-tests.md)|

19. 選擇 [部署]。

     [部署] 頁面隨即顯示。

20. 若要在每次執行測試時建立部署的個別目錄，請選取 [啟用部署]。

    > [!NOTE]
    > 如果您這樣做，可以在執行測試時繼續建置應用程式。

21. 若要將檔案新增至您用來執行測試的目錄，請選擇 [新增檔案]，然後選取您要新增的檔案。

    > [!NOTE]
    > 當您執行負載測試時，外掛程式組件、資料檔和上傳的檔案都會自動部署。

22. 若要將目錄新增至您用來執行測試的目錄，請選擇 [新增目錄]，然後選取您要新增的目錄。

23. 若要在測試之前和之後執行指令碼，請選擇 [安裝和清除指令碼]。

     [安裝和清除指令碼] 頁面隨即顯示。

    1. 在 [安裝指令碼] 中鍵入指令碼檔的位置，或選擇省略符號 (**…**) 尋找安裝指令碼。

    2. 在 [清除指令碼] 中鍵入指令碼檔的位置，或選擇省略符號 (**…**) 尋找清除指令碼。

24. 若要使用不同主機執行測試，請選擇 [主機]。

    1. 在 [主機類型] 中，確認已選取 [預設]。

        > [!NOTE]
        > 負載測試不支援 [主機類型] 中的 [ASP.NET]。

    2. 使用 [ **在32位或64位進程中執行測試** ] 下拉式清單，選取您要讓負載測試中的 web 效能和單元測試以32位或64位進程的形式執行。

        > [!NOTE]
        > 為了達到最大彈性，您應該使用 [ **任何 CPU** ] 設定來編譯 web 效能和負載測試專案。 然後，您就可以在 32 位元和 64 位元代理程式上執行。 使用 [64 位元] 組態編譯 Web 效能和負載測試專案不會提供任何優勢。

25. (選擇性) 若要限制每個測試回合和個別測試的時間，請選擇 [測試逾時]。

    1. 若要在超過時間限制時中止測試回合，請選取 [如果總時間超過以下值，即中止測試回合]，然後鍵入此限制的值。

    2. 若要讓個別測試在超過時間限制時失敗，請選取 [如果個別測試執行時間超過以下值，便將該測試標記為失敗]，然後鍵入此限制值。

26. 略過 [單元測試]。 負載測試不會使用這些設定。

27. 略過 [Web 測試]。 負載測試不會使用這些設定。

28. 若要儲存測試設定，請選擇 [另存新檔]。 在 [物件名稱] 中，鍵入您想要檔案的名稱。

## <a name="remove-a-test-settings-file-from-your-solution"></a>從您的解決方案中移除測試設定檔

在 **方案總管** 的 [**方案專案**] 資料夾底下，以滑鼠右鍵按一下您要移除的測試設定，然後選擇 [**移除**]。

這個測試設定檔案就會從您的方案移除。

## <a name="see-also"></a>另請參閱

- [測試控制器和測試代理程式](configure-test-agents-and-controllers-for-load-tests.md)
- [使用測試設定收集診斷資訊](../test/collect-diagnostic-information-using-test-settings.md)
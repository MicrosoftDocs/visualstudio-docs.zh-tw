---
title: 逐步解說：偵錯多執行緒應用程式 |Microsoft Docs
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
dev_langs:
- FSharp
- VB
- CSharp
- C++
helpviewer_keywords:
- multithreaded debugging, walkthrough
- walkthroughs, multithreaded debugging
ms.assetid: 590ffd57-0556-43d8-8962-ee27e5b2b7d7
caps.latest.revision: 42
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 8fead0386d1ba820be21e65009c78791c7368bcd
ms.sourcegitcommit: 8b538eea125241e9d6d8b7297b72a66faa9a4a47
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/23/2019
ms.locfileid: "58945694"
---
# <a name="walkthrough-debugging-a-multithreaded-application"></a>逐步解說：偵錯多執行緒應用程式
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

[!INCLUDE[vs_dev11_long](../includes/vs-dev11-long-md.md)] 提供改良**執行緒**視窗和其他使用者介面改進，可讓您更輕鬆地偵錯多執行緒應用程式。 只需花幾分鐘完成這份逐步解說，您便能更熟悉對多執行緒應用程式偵錯時的新介面功能。  
  
 開始本逐步解說之前，您需要一個多執行緒應用程式。 請依照下列步驟建立專案。  
  
#### <a name="to-create-the-walkthrough-project"></a>若要建立逐步解說專案  
  
1.  在 **檔案**功能表上，選擇**新增**，然後按一下 **專案**。  
  
     [ **新增專案** ] 對話方塊隨即出現。  
  
2.  在 **專案類型**s 方塊中，按一下您所選擇的語言：**Visual Basic**，**視覺化C#** ，或**Visual c + +**。  
  
3.  在 **範本**方塊中，選擇**主控台應用程式**或是**CLR 主控台應用程式**。  
  
4.  在 **名稱**方塊中，輸入名稱 MyThreadWalkthroughApp。  
  
5.  按一下 [確定 **Deploying Office Solutions**]。  
  
     新的主控台專案隨即出現。 專案建立之後，便會出現原始程式檔 (Source File)。 根據您所選擇的語言，原始程式檔的名稱可能是 Module1.vb、Program.cs 或 MyThreadWalkthroughApp.cpp  
  
6.  刪除出現在原始程式檔中的程式碼，並取代範例程式碼，會出現在 「 建立執行緒 > 主題的章節[建立的執行緒和開始時間傳遞資料](http://msdn.microsoft.com/library/52b32222-e185-4f42-91a7-eaca65c0ab6d)。  
  
7.  在 [檔案] 功能表上按一下 [全部儲存]。  
  
#### <a name="to-begin-the-walkthrough"></a>若要開始逐步解說  
  
-   在來源視窗中，尋找下列程式碼：  
  
    ```vb  
    Thread.Sleep(3000)   
    Console.WriteLine(  
    ```  
  
```csharp  
Thread.Sleep(3000);  
Console.WriteLine();  
```  
  
```cpp  
Thread::Sleep(3000);  
Console.WriteLine();  
```  
  
#### <a name="to-start-debugging"></a>若要啟動偵錯  
  
1.  以滑鼠右鍵按一下`Console.WriteLine`陳述式中，指向**中斷點**，然後按一下**插入中斷點**。  
  
     來源視窗左邊的裝訂邊中會出現紅色圓球。 這表示這個位置現在已設定中斷點。  
  
2.  按一下 [偵錯] 功能表上的 [開始偵錯]。  
  
     偵錯作業啟動，您的主控台應用程式 (Console Application) 開始執行，然後在中斷點停止。  
  
3.  如果目前焦點在主控台應用程式視窗上，請按一下 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] 視窗將焦點還給 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]。  
  
4.  在來源視窗中，尋找包含下列程式碼的那一行：  
  
    ```vb  
    Thread.Sleep(5000)   
    ```  
  
```csharp  
Thread.Sleep(3000);  
```  
  
```cpp  
Thread::Sleep(3000);  
```  
  
1.  
  
#### <a name="to-discover-the-thread-marker"></a>若要尋找執行緒標記  
  
1. 以滑鼠右鍵按一下**執行緒** 視窗中，然後按一下**在來源中顯示執行緒**。  
  
2. 查看來源視窗左邊的裝訂邊。 在這條線上，您會看見有個像是兩條布條的圖示。 其中一條是紅色、另一條是藍色。 執行緒標記表示執行緒會停在這個位置上。 執行緒可能會停在這個位置上。  
  
3. 將指標移到執行緒標記上。 資料提示方塊隨即出現。 資料提示方塊會指出每個已停止的執行緒的名稱和執行緒 ID 編號。 此案例中只有一個執行緒，其名稱可能為 `<noname>`。  
  
4. 以滑鼠右鍵按一下執行緒標記。 請注意捷徑功能表上的選項。  
  
   此圖示*執行緒標記*:  
  
   ![執行緒標記](../debugger/media/threadmarker.gif "ThreadMarker")  
  
## <a name="flagging-and-unflagging-threads"></a>將執行緒加上旗標和取消旗標  
 在 [!INCLUDE[vs_orcas_long](../includes/vs-orcas-long-md.md)] 中，您可以為需要特別注意的執行緒加上旗標。 為執行緒加上旗標可方便您追蹤重要的執行緒，而忽略您無需注意的執行緒。  
  
#### <a name="to-flag-threads"></a>若要為執行緒加上旗標  
  
1.  在 **檢視**功能表上，指向**工具列**。  
  
     請確定**偵錯位置**工具列選取。  
  
2.  移至**偵錯位置**工具列，並按一下**執行緒**清單。  
  
    > [!NOTE]
    >  您可以透過三個明顯的清單辨認出這個工具列：**處理程序**，**執行緒**，以及**堆疊框架**。  
  
3.  注意清單中出現的執行緒數。  
  
4.  請返回來源視窗，以滑鼠右鍵按一下**執行緒**標記一次。  
  
5.  在捷徑功能表，指向**旗標**，然後按一下執行緒名稱和識別碼。  
  
6.  請返回**偵錯位置**工具列，並按一下**執行緒**列出一次。  
  
     現在清單中只會出現加上旗標的執行緒。 旗標按鈕就位於右邊**執行緒**清單。 按鈕上的旗標圖示先前呈現暗灰色。 現在成為亮紅色。  
  
7.  將指標移到旗標圖示上。  
  
     快顯視窗隨即出現。 這個快顯視窗會告訴您何種模式下**執行緒**清單：**僅顯示已標幟的執行緒**。  
  
8.  按一下可切換回到 [旗標] 按鈕**顯示所有執行緒**模式。  
  
9. 按一下 **執行緒**清單，並確認您現在可以一次看見所有執行緒。  
  
10. 按一下可切換回到 [旗標] 按鈕**僅顯示已標幟的執行緒**。  
  
11. 在 [偵錯] 功能表上，指向 [視窗]，然後按一下 [執行緒]。  
  
     **執行緒** 視窗隨即出現。 每個執行緒都附有一個明顯的旗標圖示。  
  
12. 在來源視窗中，再次以滑鼠右鍵按一下執行緒標記。  
  
     請注意捷徑功能表上目前可用的選項。 而不是**旗標**，您現在會看到**取消旗標**。 請勿按下**取消旗標**。  
  
13. 進入關於如何取消執行緒之旗標的下一個程序。  
  
#### <a name="to-unflag-threads"></a>若要取消執行緒的旗標  
  
1.  在 [**執行緒**] 視窗中，以滑鼠右鍵按一下對應到已標幟的執行緒的行。  
  
     捷徑功能表即會顯示。 它有選項可讓**取消旗標**並**取消所有旗標**。  
  
2.  若要取消執行緒的旗標，按一下**取消旗標**。  
  
3.  按一下紅色旗標圖示。  
  
4.  看看**偵錯位置**工具列一次。 旗標按鈕再次呈現為暗灰色。 您已將唯一有旗標的執行緒取消旗標。 因為沒有已標幟的執行緒，工具列回到**顯示所有執行緒**模式。 按一下 **執行緒**清單，並確認您可看見所有執行緒。  
  
5.  請返回**執行緒**視窗並查看資訊欄。  
  
     每欄頂端的按鈕大都有用來識別該欄的標題。 但左側的第一欄沒有標題。 但它具有圖示，這個圖示為旗標的外框。 您會在執行緒清單的每一列注意到同樣的外框。 這個外框表示這個執行緒已經取消旗標了。  
  
6.  分別按一下兩個執行緒 (清單底端倒數第二和第三個) 的外框。  
  
     旗標圖示會成為紅色，而非空心的外框。  
  
7.  按一下旗標欄位頂端的按鈕。  
  
     按一下這個按鈕，執行緒清單的順序就會變更。 執行緒清單現在的排序是將加上旗標的執行緒列於最上方。  
  
8.  再按一下旗標欄位頂端的按鈕。  
  
     排序順序會再次變更。  
  
## <a name="more-about-the-threads-window"></a>執行緒視窗的相關資訊  
  
#### <a name="to-learn-more-about-the-threads-window"></a>若要進一步了解執行緒視窗  
  
1.  在 [**執行緒**] 視窗中，檢查從左邊的第三個資料行。 在此資料行頂端的按鈕顯示**識別碼**。  
  
2.  按一下 **識別碼**。  
  
     執行緒清單現在會依照執行緒 ID 編號排序。  
  
3.  以滑鼠右鍵按一下清單中任一個執行緒。 在捷徑功能表，按一下 **十六進位顯示**。  
  
     執行緒 ID 編號的格式即會變更。  
  
4.  將滑鼠指標移到清單中的任一執行緒上。  
  
     稍等一下，資料提示方塊就會出現。 它會顯示執行緒的部分呼叫堆疊。  
  
5.  查看第四個資料行，從左邊標示**分類**。 執行緒已分到這些類別中。  
  
     處理序中第一個建立的執行緒稱為主執行緒。 請在執行緒清單中找出這個執行緒。  
  
6.  以滑鼠右鍵按一下主執行緒，然後按一下**切換至執行緒**。  
  
     警告對話方塊隨即出現。 警告中指出 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] 無法顯示主執行緒的原始程式碼。  
  
     按一下 [確定 **Deploying Office Solutions**]。  
  
7.  看看**呼叫堆疊**視窗和**偵錯位置**工具列。  
  
     內容**呼叫堆疊**視窗已變更。  
  
## <a name="switching-the-active-thread"></a>切換使用中執行緒  
  
#### <a name="to-switch-threads"></a>若要切換執行緒  
  
1.  在 [**執行緒**] 視窗中，檢查從左邊的第二個資料行。 這個欄位頂端的按鈕沒有文字或圖示。 這個資料行**作用中執行緒**資料行。  
  
2.  看看**作用中執行緒**欄位，並注意其中一個執行緒具有黃色箭號。 這是*使用中執行緒指示器*。  
  
3.  記下使用中執行緒指示器所在的執行緒 ID 編號。 您會將使用中執行緒指示器移至其他執行緒，但您必須在完成作業後將其放回。  
  
4.  另一個執行緒上按一下滑鼠右鍵，然後按一下 **切換至執行緒**。  
  
5.  看看**呼叫堆疊**在來源視窗的視窗。 內容已有所變更。  
  
6.  看看**偵錯位置**工具列。 使用中執行緒也已變更。  
  
7.  移至**偵錯位置**工具列。 按一下 **執行緒**方塊，然後從下拉式清單中選擇不同的執行緒。  
  
8.  看看**執行緒**視窗。 使用中執行緒指示器已有所變更。  
  
9. 在來源視窗中，以滑鼠右鍵按一下執行緒標記。 在捷徑功能表，指向**切換至**按一下執行緒名稱 /ID 編號。  
  
     您現在有三種變更使用中執行緒的方式： 使用**執行緒** 視窗中，**執行緒**方塊中**偵錯位置**工具列和中的執行緒指示器來源 視窗中。  
  
     使用執行緒指示器時，您只能切換到停止在特定位置的執行緒。 使用 [執行緒] 視窗和 [偵錯位置] 工具列時，您可以切換至任何執行緒。  
  
## <a name="freezing-and-thawing-thread-execution"></a>凍結和解除凍結執行緒的執行  
  
#### <a name="to-freeze-and-unfreeze-threads"></a>若要凍結和解除凍結執行緒  
  
1.  在 [**執行緒**] 視窗中，以滑鼠右鍵按一下任何執行緒，然後按一下**凍結**。  
  
2.  查看使用中執行緒欄位。 該處現在會出現一對垂直列。 這兩條藍色列表示該執行緒已遭凍結。  
  
3.  看看**暫止**資料行。 執行緒的暫停次數 (Suspend Count) 現在是 1。  
  
4.  以滑鼠右鍵按一下凍結的執行緒，然後按一下 **解除凍結**。  
  
     使用中執行緒欄位和**暫止**資料行變更。  
  
## <a name="see-also"></a>另請參閱  
 [對多執行緒應用程式進行偵錯](../debugger/debug-multithreaded-applications-in-visual-studio.md)   
 [如何：在偵錯時切換到另一個執行緒](../debugger/how-to-switch-to-another-thread-while-debugging.md)
